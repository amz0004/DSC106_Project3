<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>US Fire Map (Day/Night)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
    }
    svg {
      width: 100%;
      height: 90vh;
    }
    button {
      margin: 10px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background: #444;
      color: white;
      cursor: pointer;
    }
    button.active {
      background: #ff5722;
    }
  </style>
</head>
<body>
  <h2>NASA Fire Data (Day vs Night)</h2>
  <div>
    <button id="dayBtn" class="active">Day Fires</button>
    <button id="nightBtn">Night Fires</button>
  </div>
  <svg id="fireMap"></svg>

  <script>
    const width = window.innerWidth;
    const height = window.innerHeight * 0.85;
    const svg = d3.select("#fireMap");

    const projection = d3.geoAlbersUsa()
      .translate([width / 2, height / 2])
      .scale(1000);

    const path = d3.geoPath().projection(projection);

    Promise.all([
      d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json"),
      d3.json("fires.geojson")
    ]).then(([us, fires]) => {
      const states = topojson.feature(us, us.objects.states);

      // Draw map
      svg.append("g")
        .selectAll("path")
        .data(states.features)
        .enter()
        .append("path")
        .attr("d", path)
        .attr("fill", "#333")
        .attr("stroke", "#555");

      const pointsGroup = svg.append("g");

      function update(daynight) {
        const filtered = fires.features.filter(f => f.properties.DAYNIGHT === daynight);
        const color = daynight === "D" ? "red" : "skyblue";

        const points = pointsGroup.selectAll("circle")
          .data(filtered, d => d.properties.ACQ_DATE + d.geometry.coordinates);

        points.enter()
          .append("circle")
          .attr("cx", d => projection(d.geometry.coordinates)[0])
          .attr("cy", d => projection(d.geometry.coordinates)[1])
          .attr("r", 2)
          .attr("fill", color)
          .attr("opacity", 0.7)
          .merge(points)
          .transition()
          .duration(500)
          .attr("fill", color);

        points.exit().remove();
      }

      d3.select("#dayBtn").on("click", () => {
        update("D");
        d3.select("#dayBtn").classed("active", true);
        d3.select("#nightBtn").classed("active", false);
      });

      d3.select("#nightBtn").on("click", () => {
        update("N");
        d3.select("#dayBtn").classed("active", false);
        d3.select("#nightBtn").classed("active", true);
      });

      update("D");
    });
  </script>
</body>
</html>
